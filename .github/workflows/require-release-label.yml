name: Require Release Label

on:
  pull_request:
    types: [opened, labeled, unlabeled, synchronize]
    branches: [master]

jobs:
  check-label:
    runs-on: ubuntu-latest
    steps:
      - name: Check for release label
        uses: actions/github-script@f28e40c7f34bde8b3046d885e986cb6290c5673b # v7
        with:
          script: |
            const labels = context.payload.pull_request.labels.map(l => l.name);
            const releaseLabels = labels.filter(l => l.startsWith('release:'));
            if (releaseLabels.length === 0) {
              core.setFailed('PR must have a release label: release:major, release:minor, or release:patch');
            } else if (releaseLabels.length > 1) {
              core.setFailed('PR must have exactly one release label, found: ' + releaseLabels.join(', '));
            } else {
              core.info('Release label found: ' + releaseLabels[0]);
            }
